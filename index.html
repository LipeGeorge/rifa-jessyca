<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa da Amiga</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Estilos simples para os estados dos n√∫meros */
        .numero-card {
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #ddd;
        }
        .numero-livre:hover { transform: scale(1.05); border-color: #28a745; }
        
        /* Classes de estado */
        .bg-livre { background-color: #f8f9fa; color: #333; }
        .bg-selecionado { background-color: #28a745; color: white; border-color: #28a745; }
        .bg-vendido { background-color: #dc3545; color: white; cursor: not-allowed; opacity: 0.6; }

        /* Barra flutuante de checkout */
        #checkout-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none; /* Come√ßa escondida */
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-light pb-5">

    <div class="container py-5 mb-5">
        <div class="text-center mb-5">
            <h1>üéüÔ∏è Rifa Beneficente</h1>
            <p class="lead">Selecione seus n√∫meros e clique em reservar!</p>
            <div class="d-flex justify-content-center gap-3">
                <div><span class="badge bg-light text-dark border">Livre</span></div>
                <div><span class="badge bg-success">Selecionado</span></div>
                <div><span class="badge bg-danger">Vendido</span></div>
            </div>
        </div>

        <div id="grid-numeros" class="row row-cols-4 row-cols-md-6 row-cols-lg-10 g-2">
            <div class="col text-center">Carregando...</div>
        </div>
    </div>

    <div id="checkout-bar">
        <div class="container d-flex justify-content-between align-items-center">
            <div>
                <h5 class="m-0">Selecionados: <span id="contador-selecao">0</span></h5>
                <small class="text-muted">Total: R$ <span id="valor-total">0,00</span></small>
            </div>
            <button onclick="enviarWhatsApp()" class="btn btn-success btn-lg">
                Reservar no WhatsApp Ôì≤
            </button>
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ïES ---
        // COLE AQUI O LINK DO CSV QUE VOC√ä GEROU NO PASSO 1
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRKGsyuscKYI0aLYldQ06Jq6tyvGgOyIupFnrljpdLwv0v1Unh8A9FNDwYpeF8QpKCYUoH7YPLsa2Bs/pub?output=csv'; 
        
        const PRECO_POR_NUMERO = 10.00; // Valor da rifa
        const WHATSAPP_NUMERO = '5588981688970'; // N√∫mero da sua amiga (com 55 e DDD)

        // --- ESTADO DA APLICA√á√ÉO ---
        let numerosSelecionados = [];

        // --- L√ìGICA ---
        async function carregarDados() {
            try {
                const response = await fetch(SHEET_URL);
                const data = await response.text();
                processarCSV(data);
            } catch (error) {
                console.error('Erro ao carregar:', error);
                document.getElementById('grid-numeros').innerHTML = '<p class="text-danger text-center">Erro ao carregar os n√∫meros. Avise o administrador.</p>';
            }
        }

        function processarCSV(textoCsv) {
            const linhas = textoCsv.split('\n');
            const grid = document.getElementById('grid-numeros');
            grid.innerHTML = ''; // Limpa o loading

            // Come√ßa do i=1 para pular o cabe√ßalho da planilha
            for (let i = 1; i < linhas.length; i++) {
                // Divide a linha por v√≠rgula (CSV simples)
                const colunas = linhas[i].split(',');
                if (colunas.length < 2) continue;

                const numero = colunas[0].trim();
                const status = colunas[1].trim().toLowerCase(); // "livre" ou "vendido"

                criarElementoNumero(numero, status);
            }
        }

        function criarElementoNumero(numero, status) {
            const grid = document.getElementById('grid-numeros');
            const div = document.createElement('div');
            div.className = 'col';

            // Define a classe baseada no status vindo da planilha
            let classeCor = status === 'vendido' ? 'bg-vendido' : 'bg-livre';
            
            div.innerHTML = `
                <div class="card h-100 numero-card ${classeCor}" 
                     id="num-${numero}"
                     onclick="toggleNumero('${numero}', '${status}')">
                    <div class="card-body d-flex align-items-center justify-content-center p-2">
                        <h5 class="m-0 fw-bold">${numero}</h5>
                    </div>
                </div>
            `;
            grid.appendChild(div);
        }

        function toggleNumero(numero, statusOriginal) {
            if (statusOriginal === 'vendido') return; // N√£o faz nada se j√° vendeu

            const index = numerosSelecionados.indexOf(numero);
            const elemento = document.getElementById(`num-${numero}`);

            if (index > -1) {
                // Se j√° estava selecionado, remove
                numerosSelecionados.splice(index, 1);
                elemento.classList.remove('bg-selecionado');
                elemento.classList.add('bg-livre');
            } else {
                // Se n√£o estava, adiciona
                numerosSelecionados.push(numero);
                elemento.classList.remove('bg-livre');
                elemento.classList.add('bg-selecionado');
            }

            atualizarBarraCheckout();
        }

        function atualizarBarraCheckout() {
            const barra = document.getElementById('checkout-bar');
            const contador = document.getElementById('contador-selecao');
            const total = document.getElementById('valor-total');

            if (numerosSelecionados.length > 0) {
                barra.style.display = 'block';
                contador.innerText = numerosSelecionados.join(', ');
                total.innerText = (numerosSelecionados.length * PRECO_POR_NUMERO).toFixed(2).replace('.', ',');
            } else {
                barra.style.display = 'none';
            }
        }

        function enviarWhatsApp() {
            if (numerosSelecionados.length === 0) return;

            const nums = numerosSelecionados.join(', ');
            const total = (numerosSelecionados.length * PRECO_POR_NUMERO).toFixed(2).replace('.', ',');
            
            // Cria a mensagem
            const mensagem = `Ol√°! Gostaria de reservar os n√∫meros: *${nums}*. Total: R$ ${total}. Como fa√ßo o Pix?`;
            
            // Abre o WhatsApp
            const link = `https://wa.me/${WHATSAPP_NUMERO}?text=${encodeURIComponent(mensagem)}`;
            window.open(link, '_blank');
        }

        // Inicia tudo
        carregarDados();
    </script>
</body>
</html>