<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa da Jessyca</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>

        /* --- Estilos do Timer --- */

        .timer-container {
            /* Apenas centraliza o conte√∫do */
            text-align: center;
        }

        .timer-badge {
            /* A "etiqueta" laranja */
            display: inline-block;
            background-color: #f39c12; /* Um tom de laranja/√¢mbar */
            color: #333; /* Texto escuro para contrastar */
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        #countdown-display {
            /* A caixa branca do rel√≥gio */
            display: inline-block; /* Faz a caixa ter o tamanho do conte√∫do */
            background-color: white;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px 24px;
            margin: 10px 0; /* Espa√ßamento entre as etiquetas */
            
            /* Estilo da fonte */
            font-size: 1.75rem; /* Tamanho grande */
            font-weight: bold;
            color: #333;
        }

        /* Efeito de hover para os n√∫meros LIVRES */
        .numero-card.bg-livre:hover {
            transform: scale(1.05); /* Efeito de 'saltar' levemente */
            border-color: #28a745;  /* Borda fica verde (cor de sele√ß√£o) */
            border-width: 2px;      /* Garante que a borda fique mais grossa */
            cursor: pointer;           /* Mostra a 'm√£ozinha' */
        }

        /* For√ßa a cor do bot√£o (Exemplo TEMA VERDE) */
        #btn-reservar {
            background-color: #28a745; /* Verde padr√£o do Bootstrap */
            border-color: #28a745;
        }

        /* Define o hover (um verde mais escuro) */
        #btn-reservar:hover {
            background-color: #218838; 
            border-color: #1e7e34;
        }

        body {
            /* Define o degrad√™ */
            background-image: linear-gradient(
                to bottom,  /* A dire√ß√£o: de cima para baixo */
                #05193f,     /* Cor inicial: um azul-c√©u */
                #FFFFFF      /* Cor final: branco */
            );
            
            /* Garante que o degrad√™ cubra a tela inteira, mesmo se o conte√∫do for curto */
            min-height: 100vh;
            
            /* Previne que a imagem de fundo se repita */
            background-repeat: no-repeat;
        }

        /* Estilos simples para os estados dos n√∫meros */
        .numero-card {
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #ddd;
        }
        .numero-livre:hover { transform: scale(1.05); border-color: #28a745; }
        
        /* Classes de estado */
        .bg-livre { background-color: #f8f9fa; color: #333; }
        .bg-selecionado { background-color: #28a745; color: white; border-color: #28a745; }
        .bg-vendido { background-color: #dc3545; color: white; cursor: not-allowed; opacity: 0.6; }

        /* Barra flutuante de checkout */
        #checkout-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none; /* Come√ßa escondida */
            z-index: 1000;
        }
    </style>
</head>
<body class="pb-5">

    <div class="container py-5 mb-5 bg-white rounded shadow">

        <div class="text-center mb-5">
            <h1>üéüÔ∏è Rifa da Jessyca</h1>
            <p class="lead">Selecione seus n√∫meros e clique em reservar!</p>
            <div class="timer-container my-4">
                <div class="timer-badge">O sorteio ser√° em:</div>
                <div id="countdown-display" class="shadow-sm">Carregando...</div>
                <div class="timer-badge">Dia 20 dez √†s 22h</div>
            </div>
            <div class="d-flex justify-content-center gap-3">
                </div>


            <div class="d-flex justify-content-center gap-3">
                <div><span class="badge bg-light text-dark border">Livre</span></div>
                <div><span class="badge bg-success">Selecionado</span></div>
                <div><span class="badge bg-danger">Vendido</span></div>
            </div>
        </div>

        <div id="grid-numeros" class="row row-cols-4 row-cols-md-6 row-cols-lg-10 g-2">
            <div class="col text-center">Carregando...</div>
        </div>
    </div>

    <div id="checkout-bar">
        <div class="container d-flex justify-content-between align-items-center">
            <div>
                <h5 class="m-0">Selecionados: <span id="contador-selecao">0</span></h5>
                <small class="text-muted">Total: R$ <span id="valor-total">0,00</span></small>
            </div>
            <button onclick="enviarWhatsApp()" class="btn btn-success btn-lg" id="btn-reservar">
                Continuar para WhatsApp
            </button>
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ïES ---
        // COLE AQUI O LINK DO CSV QUE VOC√ä GEROU NO PASSO 1
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRKGsyuscKYI0aLYldQ06Jq6tyvGgOyIupFnrljpdLwv0v1Unh8A9FNDwYpeF8QpKCYUoH7YPLsa2Bs/pub?output=csv'; 
        
        const PRECO_POR_NUMERO = 10.00; // Valor da rifa
        const WHATSAPP_NUMERO = '5588981688970'; // N√∫mero da sua amiga (com 55 e DDD)

        // --- ESTADO DA APLICA√á√ÉO ---
        let numerosSelecionados = [];

        // --- L√ìGICA DO COUNTDOWN TIMER ---

        // 1. Defina a data final do sorteio
        // IMPORTANTE: O m√™s em JavaScript vai de 0 a 11 (Jan=0, Fev=1, ..., Nov=10, Dez=11)
        // Formato: Ano, M√™s (0-11), Dia, Hora, Minuto, Segundo
        const dataSorteio = new Date(2025, 11, 20, 22, 0, 0).getTime(); // Ex: 20 de Nov de 2025 √†s 22:00

        // 2. Armazena o elemento do timer
        const timerElement = document.getElementById('countdown-display');

        // 3. Atualiza o timer a cada 1 segundo
        const timerInterval = setInterval(function() {
            const agora = new Date().getTime();
            const distancia = dataSorteio - agora;

            if (distancia < 0) {
                // Se o tempo acabou
                clearInterval(timerInterval);
                timerElement.innerHTML = "üéâ Sorteio Realizado! üéâ";
                // Muda o estilo para verde (opcional)
                timerElement.style.backgroundColor = "#28a745";
                timerElement.style.color = "white";
            } else {
                // Se ainda h√° tempo, calcula
                const dias = Math.floor(distancia / (1000 * 60 * 60 * 24));
                const horas = Math.floor((distancia % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutos = Math.floor((distancia % (1000 * 60 * 60)) / (1000 * 60));
                const segundos = Math.floor((distancia % (1000 * 60)) / 1000);

                // 4. Exibe o resultado no HTML (o ‚è∞ √© um emoji)
                timerElement.innerHTML = `‚è∞ ${dias}d ${horas}h ${minutos}m ${segundos}s`;
            }
        }, 1000);

        // --- L√ìGICA ---
        async function carregarDados() {
            try {
                const response = await fetch(SHEET_URL);
                const data = await response.text();
                processarCSV(data);
            } catch (error) {
                console.error('Erro ao carregar:', error);
                document.getElementById('grid-numeros').innerHTML = '<p class="text-danger text-center">Erro ao carregar os n√∫meros. Avise o administrador.</p>';
            }
        }

        function processarCSV(textoCsv) {
            const linhas = textoCsv.split('\n');
            const grid = document.getElementById('grid-numeros');
            grid.innerHTML = ''; // Limpa o loading

            // Come√ßa do i=1 para pular o cabe√ßalho da planilha
            for (let i = 1; i < linhas.length; i++) {
                // Divide a linha por v√≠rgula (CSV simples)
                const colunas = linhas[i].split(',');
                if (colunas.length < 2) continue;

                const numero = colunas[0].trim();
                const status = colunas[1].trim().toLowerCase(); // "livre" ou "vendido"

                criarElementoNumero(numero, status);
            }
        }

        function criarElementoNumero(numero, status) {
            const grid = document.getElementById('grid-numeros');
            const div = document.createElement('div');
            div.className = 'col';

            // Define a classe baseada no status vindo da planilha
            let classeCor = status === 'vendido' ? 'bg-vendido' : 'bg-livre';
            
            div.innerHTML = `
                <div class="card h-100 numero-card ${classeCor}" 
                     id="num-${numero}"
                     onclick="toggleNumero('${numero}', '${status}')">
                    <div class="card-body d-flex align-items-center justify-content-center p-2">
                        <h5 class="m-0 fw-bold">${numero}</h5>
                    </div>
                </div>
            `;
            grid.appendChild(div);
        }

        function toggleNumero(numero, statusOriginal) {
            if (statusOriginal === 'vendido') return; // N√£o faz nada se j√° vendeu

            const index = numerosSelecionados.indexOf(numero);
            const elemento = document.getElementById(`num-${numero}`);

            if (index > -1) {
                // Se j√° estava selecionado, remove
                numerosSelecionados.splice(index, 1);
                elemento.classList.remove('bg-selecionado');
                elemento.classList.add('bg-livre');
            } else {
                // Se n√£o estava, adiciona
                numerosSelecionados.push(numero);
                elemento.classList.remove('bg-livre');
                elemento.classList.add('bg-selecionado');
            }

            atualizarBarraCheckout();
        }

        function atualizarBarraCheckout() {
            const barra = document.getElementById('checkout-bar');
            const contador = document.getElementById('contador-selecao');
            const total = document.getElementById('valor-total');

            if (numerosSelecionados.length > 0) {
                barra.style.display = 'block';
                contador.innerText = numerosSelecionados.join(', ');
                total.innerText = (numerosSelecionados.length * PRECO_POR_NUMERO).toFixed(2).replace('.', ',');
            } else {
                barra.style.display = 'none';
            }
        }

        function enviarWhatsApp() {
            if (numerosSelecionados.length === 0) return;

            const nums = numerosSelecionados.join(', ');
            const total = (numerosSelecionados.length * PRECO_POR_NUMERO).toFixed(2).replace('.', ',');
            
            // Cria a mensagem
            const mensagem = `Ol√°! Gostaria de reservar os n√∫meros: *${nums}*. Total: R$ ${total}. Como fa√ßo o Pix?`;
            
            // Abre o WhatsApp
            const link = `https://wa.me/${WHATSAPP_NUMERO}?text=${encodeURIComponent(mensagem)}`;
            window.open(link, '_blank');
        }

        // Inicia tudo
        carregarDados();
    </script>
</body>
</html>